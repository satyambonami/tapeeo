<?php 

require '../inc/dompdf/vendor/autoload.php';

if(isset($_GET['id'])){
	$orderId = mysqli_real_escape_string($conn, $_GET['id']);
	if(isset($_GET['id'])){
		$id = mysqli_real_escape_string($conn, $_GET['id']);
		$dataQ = mysqli_query($conn, "SELECT ord.*, u.name as u_name, u.email as u_email, u.phone as u_phone, u.country as u_country, u.state as u_state, u.city as u_city, u.pincode as u_pincode, u.address as u_address FROM `".$tblPrefix."orders` ord LEFT JOIN `".$tblPrefix."user_address` u ON ord.address_id= u.id  WHERE ord.status!=0 AND ord.id=$orderId");
		$data = mysqli_fetch_assoc($dataQ);
		$priceArr = explode(',', $data['prod_prices']);
		$quantityArr = explode(',', $data['prod_quantity']);
		$prodIdArr = explode(',', $data['prod_id']);
        $city = city($data['u_city']);
        $state = state($data['u_state']);
        $country  = country($data['u_country']);
	}
}else{
	$_SESSION['toast']['msg'] = "Something went wrong, Please try again.";
	header("location:index.php");
	exit();
}

// reference the Dompdf namespace
use Dompdf\Dompdf;

// instantiate and use the dompdf class
$dompdf = new Dompdf();

$html=
    '<!DOCTYPE html><html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>Invoice</title><style id="applicationStylesheet" type="text/css">.mediaViewInfo{--web-view-name:Custom Size – 1;--web-view-id:Custom_Size__1;--web-scale-on-resize:true;--web-enable-deep-linking:true}:root{--web-view-ids:Custom_Size__1}*{margin:0;padding:0;box-sizing:border-box;border:none}#Custom_Size__1{position:absolute;width:1414px;height:2100px;background-color:rgba(255, 255, 255, 1);overflow:hidden;--web-view-name:Custom Size – 1;--web-view-id:Custom_Size__1;--web-scale-on-resize:true;--web-enable-deep-linking:true}#Group_67{position:absolute;width:2592px;height:3302.948px;left:94px;top:-1380.69px;overflow:visible}#Pngtreepink_twisted_organic_ob{position:absolute;width:1837.265px;height:1837.265px;left:754.735px;top:0px;overflow:visible}#INVOICE{left:793px;top:1509.69px;position:absolute;overflow:visible;width:358px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:95px;color:rgba(211,54,150,1)}#logo{position:absolute;width:253px;height:85px;left:0px;top:1408.69px;overflow:visible}#Group_54{position:absolute;width:254px;height:74px;left:0px;top:1592.69px;overflow:visible}#Invoice_to{left:0px;top:0px;position:absolute;overflow:visible;width:255px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:56px;color:rgba(112,112,112,1)}#Group_64{position:absolute;width:203px;height:47px;left:28px;top:2865.69px;overflow:visible}#Payment_info{left:0px;top:0px;position:absolute;overflow:visible;width:204px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(211,54,150,1)}#Group_66{position:absolute;width:421px;height:46px;left:14px;top:3089.69px;overflow:visible}#Thank_you_for_your_business{left:0px;top:0px;position:absolute;overflow:visible;width:422px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:34px;color:rgba(211,54,150,1)}#Group_55{position:absolute;width:294px;height:188px;left:0px;top:1677.69px;overflow:visible}#Anne_Marie{left:0px;top:0px;position:absolute;overflow:visible;width:215px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#n_4_Dummy__Street__Area_Locati{opacity:0.85;left:0px;top:58px;position:absolute;overflow:visible;width:295px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:28px;color:rgba(112,112,112,1)}#Invoice{left:793px;top:1684.69px;position:absolute;overflow:visible;width:157px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#S75124{left:1039px;top:1693.69px;position:absolute;overflow:visible;width:100px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:27px;color:rgba(112,112,112,1);letter-spacing:0.86px}#n_1052021{left:1039px;top:1770.69px;position:absolute;overflow:visible;width:178px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:28px;color:rgba(112,112,112,1);letter-spacing:1.36px}#Date{left:793px;top:1754.69px;position:absolute;overflow:visible;width:86px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:41px;color:rgba(112,112,112,1)}#Group_57{position:absolute;width:1218.102px;height:932.592px;left:1.755px;top:1893.431px;overflow:visible}#Rectangle_21{opacity:0.43;fill:rgba(185,244,245,0.612);stroke:rgba(112,112,112,1);stroke-width:0.30000001192092896px;stroke-linejoin:miter;stroke-linecap:butt;stroke-miterlimit:4;shape-rendering:auto}.Rectangle_21{position:absolute;overflow:visible;width:1214.592px;height:927.17px;left:0px;top:2.711px}#Path_1119{fill:rgba(0,0,0,0);stroke:rgba(112,112,112,1);stroke-width:0.30000001192092896px;stroke-linejoin:miter;stroke-linecap:butt;stroke-miterlimit:4;shape-rendering:auto}.Path_1119{overflow:visible;position:absolute;width:1214.591px;height:0.3px;left:3.51px;top:103.992px;transform:matrix(1,0,0,1,0,0)}#Line_16{fill:transparent;stroke:rgba(112,112,112,1);stroke-width:0.20000000298023224px;stroke-linejoin:miter;stroke-linecap:butt;stroke-miterlimit:4;shape-rendering:auto}.Line_16{overflow:visible;position:absolute;width:0.2px;height:927.17px;left:150.946px;top:5.422px;transform:matrix(1,0,0,1,0,0)}#Line_17{fill:transparent;stroke:rgba(112,112,112,1);stroke-width:0.20000000298023224px;stroke-linejoin:miter;stroke-linecap:butt;stroke-miterlimit:4;shape-rendering:auto}.Line_17{overflow:visible;position:absolute;width:0.2px;height:921.748px;left:853.022px;top:2.711px;transform:matrix(1,0,0,1,0,0)}#Line_19{fill:transparent;stroke:rgba(112,112,112,1);stroke-width:0.20000000298023224px;stroke-linejoin:miter;stroke-linecap:butt;stroke-miterlimit:4;shape-rendering:auto}.Line_19{overflow:visible;position:absolute;width:0.2px;height:921.748px;left:628.358px;top:2.711px;transform:matrix(1,0,0,1,0,0)}#Line_18{fill:transparent;stroke:rgba(241,241,241,1);stroke-width:0.20000000298023224px;stroke-linejoin:miter;stroke-linecap:butt;stroke-miterlimit:4;shape-rendering:auto}.Line_18{overflow:visible;position:absolute;width:0.2px;height:926.74px;left:996.948px;top:0px;transform:matrix(1,0,0,1,0,0)}#Group_56{position:absolute;width:51px;height:56px;left:50.901px;top:1920.025px;overflow:visible}#SL{left:0px;top:0px;position:absolute;overflow:visible;width:52px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#Group_59{position:absolute;width:22px;height:54px;left:50.901px;top:2018.315px;overflow:visible}#n_{left:0px;top:0px;position:absolute;overflow:visible;width:23px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:41px;color:rgba(12,10,10,1)}#Group_60{position:absolute;width:963.491px;height:85.166px;left:177.274px;top:2018.315px;overflow:visible}#Tapeeo_band{left:0px;top:0px;position:absolute;overflow:visible;width:233px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:41px;color:rgba(12,10,10,1)}#n_000{left:484.432px;top:4.51px;position:absolute;overflow:visible;width:100px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:34px;color:rgba(12,10,10,1)}#n__bb{left:730.159px;top:8.021px;position:absolute;overflow:visible;width:20px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(12,10,10,1)}#n_5000{left:842.491px;top:8.021px;position:absolute;overflow:visible;width:122px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(12,10,10,1)}#lorem_ipsum{opacity:0.66;left:21.062px;top:58.166px;position:absolute;overflow:visible;width:111px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:20px;color:rgba(12,10,10,1)}#Group_62{position:absolute;width:1089.865px;height:85.166px;left:50.901px;top:2151.71px;overflow:visible}#Group_59_bf{position:absolute;width:21px;height:52px;left:0px;top:0px;overflow:visible}#n__bg{left:0px;top:0px;position:absolute;overflow:visible;width:22px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:39px;color:rgba(12,10,10,1)}#Group_60_bh{position:absolute;width:963.491px;height:85.166px;left:126.374px;top:0px;overflow:visible}#Tapeeo_band_bi{left:0px;top:0px;position:absolute;overflow:visible;width:233px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:41px;color:rgba(12,10,10,1)}#n_000_bj{left:470.391px;top:8.021px;position:absolute;overflow:visible;width:100px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:34px;color:rgba(12,10,10,1)}#n__bk{left:730.159px;top:8.021px;position:absolute;overflow:visible;width:20px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(12,10,10,1)}#n_5000_bl{left:842.491px;top:8.021px;position:absolute;overflow:visible;width:122px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(12,10,10,1)}#lorem_ipsum_bm{opacity:0.66;left:21.062px;top:58.166px;position:absolute;overflow:visible;width:111px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:20px;color:rgba(12,10,10,1)}#Group_63{position:absolute;width:1089.865px;height:85.166px;left:50.901px;top:2285.104px;overflow:visible}#Group_59_bo{position:absolute;width:20px;height:51px;left:0px;top:0px;overflow:visible}#n__bp{left:0px;top:0px;position:absolute;overflow:visible;width:21px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:38px;color:rgba(12,10,10,1)}#Group_60_bq{position:absolute;width:963.491px;height:85.166px;left:126.374px;top:0px;overflow:visible}#Tapeeo_band_br{left:0px;top:0px;position:absolute;overflow:visible;width:233px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:41px;color:rgba(12,10,10,1)}#n_000_bs{left:470.391px;top:8.021px;position:absolute;overflow:visible;width:100px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:34px;color:rgba(12,10,10,1)}#n__bt{left:730.159px;top:8.021px;position:absolute;overflow:visible;width:20px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(12,10,10,1)}#n_5000_bu{left:842.491px;top:8.021px;position:absolute;overflow:visible;width:122px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(12,10,10,1)}#lorem_ipsum_bv{opacity:0.66;left:21.062px;top:58.166px;position:absolute;overflow:visible;width:111px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:20px;color:rgba(12,10,10,1)}#Group_58{position:absolute;width:958.574px;height:56px;left:184.295px;top:1920.025px;overflow:visible}#Item_Decription{left:0px;top:0px;position:absolute;overflow:visible;width:289px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#Price{left:491.453px;top:0px;position:absolute;overflow:visible;width:91px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#Qty{left:695.055px;top:0px;position:absolute;overflow:visible;width:73px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:40px;color:rgba(112,112,112,1)}#Total{left:870.574px;top:0px;position:absolute;overflow:visible;width:89px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#Account_no{opacity:0.85;left:28px;top:2929.69px;position:absolute;overflow:visible;width:106px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:20px;color:rgba(112,112,112,1)}#Sub_Total{opacity:0.85;left:737.18px;top:2861.88px;position:absolute;overflow:visible;width:172px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#Total_b{opacity:0.85;left:737.18px;top:3023.357px;position:absolute;overflow:visible;width:89px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#Authorised_Sign{opacity:0.85;left:758.242px;top:3246.948px;position:absolute;overflow:visible;width:296px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#Tax{opacity:0.85;left:737.18px;top:2925.066px;position:absolute;overflow:visible;width:68px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:42px;color:rgba(112,112,112,1)}#n_2000{opacity:0.85;left:1010.989px;top:2869.9px;position:absolute;overflow:visible;width:122px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(112,112,112,1)}#n_2000_b{opacity:0.85;left:1010.989px;top:3031.378px;position:absolute;overflow:visible;width:122px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(112,112,112,1)}#n_00{opacity:0.85;left:1025.031px;top:2926.066px;position:absolute;overflow:visible;width:94px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:35px;color:rgba(112,112,112,1)}#n_123_4564_79{opacity:0.85;left:161px;top:2929.69px;position:absolute;overflow:visible;width:126px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:21px;color:rgba(112,112,112,1)}#Anne_Marie_ca{opacity:0.85;left:161px;top:2971.69px;position:absolute;overflow:visible;width:108px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:21px;color:rgba(112,112,112,1)}#add__your_back_details{opacity:0.85;left:161px;top:3013.69px;position:absolute;overflow:visible;width:204px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:21px;color:rgba(112,112,112,1)}#Ac_Name{opacity:0.85;left:28px;top:2971.69px;position:absolute;overflow:visible;width:94px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:21px;color:rgba(112,112,112,1)}#Bank_Details{opacity:0.85;left:28px;top:3013.69px;position:absolute;overflow:visible;width:114px;white-space:nowrap;text-align:left;font-family:TT Norms;font-style:normal;font-weight:normal;font-size:21px;color:rgba(112,112,112,1)}#Line_20{fill:transparent;stroke:rgba(112,112,112,1);stroke-width:0.30000001192092896px;stroke-linejoin:miter;stroke-linecap:butt;stroke-dasharray:1;stroke-dashoffset:0;stroke-miterlimit:4;shape-rendering:auto}.Line_20{overflow:visible;position:absolute;width:463.37px;height:0.3px;left:733.669px;top:3010.805px;transform:matrix(1,0,0,1,0,0)}#Line_21{fill:transparent;stroke:rgba(112,112,112,1);stroke-width:0.30000001192092896px;stroke-linejoin:miter;stroke-linecap:butt;stroke-miterlimit:4;shape-rendering:auto}.Line_21{overflow:visible;position:absolute;width:322.955px;height:0.3px;left:754.732px;top:3241.417px;transform:matrix(1, 0, 0, 1, 0, 0)}</style></head><body style="display: flex; justify-content: center;"><div id="Custom_Size__1"><div id="Group_67"><div id="INVOICE"> <span>INVOICE</span></div> <img id="logo" src="https://www.adityakundra.com/demo/tapeeo/img/logo.png" srcset="logo.png 1x, logo@2x.png 2x" /><div id="Group_54"><div id="Invoice_to"> <span>Invoice to:</span></div></div><div id="Group_64"><div id="Payment_info"> <span>Payment info</span></div></div><div id="Group_66"><div id="Thank_you_for_your_business"> <span>Thank you for your business</span></div></div><div id="Group_55"><div id="Anne_Marie"> <span>'.$data['u_name'].'</span></div><div id="n_4_Dummy__Street__Area_Locati"> <span>'.$data['u_address'].'<br />'.$country.', '.$state.', '.$city.'<br />'.$data['pincode'].'</span ><span style="font-size: 42px"> </span></div></div><div id="Invoice"> <span>Invoice#</span></div><div id="S75124"> <span>TAPEEO'.$data['id'].'</span></div><div id="n_1052021"> <span>'.date("d/M/Y",strtotime($data['time'])).'</span></div><div id="Date"> <span>Date</span></div><div id="Group_57"> <svg class="Rectangle_21"> <rect id="Rectangle_21" rx="4" ry="4" x="0" y="0" width="1214.591" height="927.17" ></rect> </svg> <svg class="Path_1119" viewBox="0 0 1214.591 0.30000001192092896"> <path id="Path_1119" d="M 0 0 L 545.6172485351562 0 L 1214.591430664062 0" ></path> </svg> <svg class="Line_16" viewBox="0 0 0.20000000298023224 927.17"> <path id="Line_16" d="M 0 0 L 0 927.169921875"></path> </svg> <svg class="Line_17" viewBox="0 0 0.20000000298023224 921.748"> <path id="Line_17" d="M 0 0 L 0 921.7479858398438"></path> </svg> <svg class="Line_19" viewBox="0 0 0.20000000298023224 921.748"> <path id="Line_19" d="M 0 0 L 0 921.7479858398438"></path> </svg> <svg class="Line_18" viewBox="0 0 0.20000000298023224 926.74"> <path id="Line_18" d="M 0 0 L 0 926.740234375"></path> </svg></div><div id="Group_56"><div id="SL"> <span>SL.</span></div></div>';

        $i=0;
        $subTotal =0;
        foreach($prodIdArr as $idKey => $idVal){
            $i++;
            $prodTotal = $quantityArr[$idKey]*$priceArr[$idKey];
            $subTotal +=$prodTotal;

            $prodQ = mysqli_query($conn, "SELECT name, image FROM `".$tblPrefix."products` WHERE pid=$idVal");
            $prodData = mysqli_fetch_assoc($prodQ);
            $html .='
                        <div id="Group_59">
                            <div id="n_">
                                <span>'.$i.'</span>
                            </div>
                        </div>
                        <div id="Group_60">
                            <div id="Tapeeo_band">
                                <span>'.$prodData['name'].'</span>
                            </div>
                            <div id="n_000">
                                <span>$'.$priceArr['idKey'].'</span>
                            </div>
                            <div id="n__bb">
                                <span>'.$quantityArr[$idKey].'</span>
                            </div>
                            <div id="n_5000">
                                <span>$'.$priceArr['idKey'].'</span>
                            </div>
                        </div>';
        }

$html.=
    '<div id="Group_58"><div id="Item_Decription"> <span>Item Decription</span></div><div id="Price"> <span>Price</span></div><div id="Qty"> <span>Qty.</span></div><div id="Total"> <span>Total</span></div></div><div id="Account_no"> <span>Account no:</span></div><div id="Sub_Total"> <span>Sub Total</span></div><div id="Total_b"> <span>Total</span></div><div id="Authorised_Sign"> <span>Authorised Sign</span></div><div id="Tax"> <span>Tax:</span></div><div id="n_2000"> <span>$220.00</span></div><div id="n_2000_b"> <span>$220.00</span></div><div id="n_00"> <span>0.00%</span></div><div id="n_123_4564_79"> <span>1123 4564 79</span></div><div id="Anne_Marie_ca"> <span>Anne Marie</span></div><div id="add__your_back_details"> <span>add your back details</span></div><div id="Ac_Name"> <span>A/c Name</span></div><div id="Bank_Details"> <span>Bank Details</span></div> <svg class="Line_20" viewBox="0 0 463.37 0.30000001192092896"> <path id="Line_20" d="M 0 0 L 463.3701171875 0"></path> </svg> <svg class="Line_21" viewBox="0 0 322.955 0.30000001192092896"> <path id="Line_21" d="M 0 0 L 322.9549255371094 0"></path> </svg></div></div></body></html>';


    $dompdf->loadHtml($html);

// (Optional) Setup the paper size and orientation
$dompdf->setPaper('A4', 'potrait');

// Render the HTML as PDF
$dompdf->render();

// Output the generated PDF to Browser
$dompdf->stream();